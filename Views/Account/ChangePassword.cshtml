@{
    ViewData["Title"] = "Change Password";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Page Header -->
            <div class="mb-4">
                <h1 class="h3 mb-0">Change Password</h1>
            </div>
            
            <div class="row">
                <!-- User Profile Navigation Sidebar -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center py-4">
                            <!-- User Avatar -->
                            <div class="avatar-circle mb-3">
                                <i class="fas fa-user-circle" style="font-size: 3.5rem; color: #b10000;"></i>
                            </div>
                            
                            <!-- User Details -->
                            @* Display user details *@
                            <h5 class="mb-1">@User.Identity?.Name</h5>
                            @*It searches for a claim of type Email else return null*@
                            <p class="text-muted small mb-3">@User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value</p>
                            
                            <!-- Navigation Links -->
                            <div class="list-group mt-3">
                                <a href="@Url.Action("Profile", "Account")" class="list-group-item list-group-item-action">
                                    <i class="fas fa-user me-2"></i> Personal Information
                                </a>
                                <a href="@Url.Action("ChangePassword", "Account")" class="list-group-item list-group-item-action active">
                                    <i class="fas fa-lock me-2"></i> Change Password
                                </a>
                                <a href="@Url.Action("Logout", "Account")" class="list-group-item list-group-item-action text-danger">
                                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Change Password Form -->
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header py-3">
                            <h5 class="mb-0">Update Your Password</h5>
                        </div>
                        <div class="card-body">
                            <!-- Success Message -->
                            @if (TempData["SuccessMessage"] != null)
                            {
                                <div class="alert alert-success alert-dismissible fade show py-2 mb-3">
                                    @TempData["SuccessMessage"]
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            }
                            
                            <!-- Validation Errors -->
                            @if (!ViewContext.ViewData.ModelState.IsValid)
                            {
                                <div class="alert alert-danger py-2 mb-3">
                                    <div asp-validation-summary="All" class="mb-0"></div>
                                </div>
                            }
                            
                            <!-- Password Form -->
                            <form asp-action="ChangePassword" method="post">
                                <!-- Current Password Field -->
                                <div class="mb-3">
                                    <label for="currentPassword" class="form-label">Current Password</label>
                                    <div class="input-group">
                                        <input type="password" id="currentPassword" name="currentPassword" class="form-control" required />
                                        <button class="btn btn-outline-secondary toggle-password" type="button" data-target="currentPassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- New Password Field -->
                                <div class="mb-3">
                                    <label for="newPassword" class="form-label">New Password</label>
                                    <div class="input-group">
                                        <input type="password" id="newPassword" name="newPassword" class="form-control" required />
                                        <button class="btn btn-outline-secondary toggle-password" type="button" data-target="newPassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Confirm Password Field -->
                                <div class="mb-4">
                                    <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                                    <div class="input-group">
                                        <input type="password" id="confirmNewPassword" name="confirmNewPassword" class="form-control" required />
                                        <button class="btn btn-outline-secondary toggle-password" type="button" data-target="confirmNewPassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="text-end mt-4">
                                    <a href="@Url.Action("Profile", "Account")" class="btn btn-outline-secondary me-2">Cancel</a>
                                    <button type="submit" class="btn btn-primary">Change Password</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    
    .avatar-circle {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background-color: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }
    
  
    .list-group-item.active {
        background-color: #b10000;
        border-color: #b10000;
    }
    
    .list-group-item:hover:not(.active) {
        background-color: #f8f9fa;
    }
    
    .btn-primary {
        background-color: #b10000;
        border-color: #b10000;
    }
    
    @* .btn-primary:hover {
        background-color: #900000;
        border-color: #900000;
    } *@
    
    
</style>

@section Scripts {
    <script>
        // PASSWORD VIZIBILITATEA EI
        document.addEventListener('DOMContentLoaded', function() {
            // Password toggle functionality
            document.querySelectorAll('.toggle-password').forEach(button => {
                button.addEventListener('click', function() {
                    const passwordInput = document.getElementById(this.getAttribute('data-target'));
                    const icon = this.querySelector('i');
                    
                    // Toggle between password and text type
                    passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password'; 
                    icon.classList.toggle('fa-eye');
                    icon.classList.toggle('fa-eye-slash');
                });
            });
        });
    </script>
}